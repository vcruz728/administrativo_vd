import{r as n,j as e,G as se,S as re}from"./app-CfIZwGwU.js";import{A as ae,p as te}from"./pageHeader-Bkp2TYq1.js";/* empty css                     */import{S as L}from"./react-select.esm-BSMfPm2J.js";import v from"./InputError-C7Q5PRis.js";import{V as $}from"./VerPdf-CarIcMA9.js";import{S as le}from"./sweetalert2.esm.all-9Qm2jZ7z.js";import{T as H}from"./TituloCard-BgBytGn6.js";import{F as oe,r as ne,p as de,a as ce}from"./filepond-plugin-file-poster-FyVueZr4.js";import{R as X,B as me,V as w}from"./index-BnXjDogV.js";import{u as ue,c as q,C as d}from"./Col-Qr9kuXVV.js";import{m as ie}from"./ElementChildren-DDLPNzr_.js";import{C as y}from"./Card-DKSS8lqU.js";import{A as pe}from"./Alert-CDckrsNG.js";import{F as c}from"./Form-BNoJLj0G.js";import"./commonimages-B1RfzdlK.js";import"./CloseButton-Cfn6-q13.js";import"./floating-ui.dom-yjPBAgC-.js";const K=1e3;function he(p,h,u){const a=(p-h)/(u-h)*100;return Math.round(a*K)/K}function U({min:p,now:h,max:u,label:a,visuallyHidden:C,striped:N,animated:x,className:j,style:g,variant:b,bsPrefix:f,..._},S){return e.jsx("div",{ref:S,..._,role:"progressbar",className:q(j,`${f}-bar`,{[`bg-${b}`]:b,[`${f}-bar-animated`]:x,[`${f}-bar-striped`]:x||N}),style:{width:`${he(h,p,u)}%`,...g},"aria-valuenow":h,"aria-valuemin":p,"aria-valuemax":u,children:C?e.jsx("span",{className:"visually-hidden",children:a}):a})}const G=n.forwardRef(({isChild:p=!1,...h},u)=>{const a={min:0,max:100,animated:!1,visuallyHidden:!1,striped:!1,...h};if(a.bsPrefix=ue(a.bsPrefix,"progress"),p)return U(a,u);const{min:C,now:N,max:x,label:j,visuallyHidden:g,striped:b,animated:f,bsPrefix:_,variant:S,className:s,children:P,...F}=a;return e.jsx("div",{ref:u,...F,className:q(s,_),children:P?ie(P,R=>n.cloneElement(R,{isChild:!0})):U({min:C,now:N,max:x,label:j,visuallyHidden:g,striped:b,animated:f,bsPrefix:_,variant:S},u)})});G.displayName="ProgressBar";ne(de,ce);function Ae({status:p,des:h,areas:u,oficioInicial:a,files:C}){const N=n.useRef(null),x=n.useRef(null),j=n.useRef(null),g=n.useRef(null),[b,f]=n.useState([]),[_,S]=n.useState(!1),[s,P]=n.useState(a||{}),[F,R]=n.useState((C||[]).map(r=>{var t,l;return{...r,file:r.file||((l=(t=r.options)==null?void 0:t.metadata)==null?void 0:l.url),source:String(r.source),options:{...r.options,type:"local"},origin:1}})),[O,J]=n.useState({destinatarioDos:!1,urlPdf:"",extension:""}),[z,B]=n.useState(!1);n.useEffect(()=>{P(a||{}),i({id:a==null?void 0:a.id,ingreso:a==null?void 0:a.ingreso,num_oficio:(a==null?void 0:a.num_oficio)||"",num_folio:(a==null?void 0:a.num_folio)||"",dep_ua:a==null?void 0:a.dep_ua,area:a==null?void 0:a.id_area,proceso_impacta:"",archivo:null,descripcion:(a==null?void 0:a.descripcion)||""}),(a==null?void 0:a.id)!==void 0&&(x.current.selectOption({value:a.dep_ua,label:a.des}),j.current.selectOption({value:a.id_area,label:a.area}),g.current.selectOption({value:a.proceso_impacta,label:a.proceso})),(a==null?void 0:a.id)>0&&setTimeout(()=>{window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})},400)},[a]);const{data:m,setData:i,errors:o,post:D,progress:V,reset:Q,setDefaults:W,cancel:Y}=se({id:s==null?void 0:s.id,ingreso:s==null?void 0:s.ingreso,num_oficio:(s==null?void 0:s.num_oficio)||"",num_folio:(s==null?void 0:s.num_folio)||"",dep_ua:s==null?void 0:s.dep_ua,area:s==null?void 0:s.id_area,proceso_impacta:"",archivo:null,descripcion:(s==null?void 0:s.descripcion)||""}),Z=r=>{r.preventDefault(),(s==null?void 0:s.id)===void 0?le.fire({title:"¿Está seguro?",text:"Una vez guardado el oficio, este no se podrá eliminar y solo se podrán editar los datos relacionados con el responsable.",icon:"warning",showDenyButton:!0,showCancelButton:!1,confirmButtonText:"Sí, estoy seguro",denyButtonText:"Cancelar",customClass:{container:"swalSuperior"}}).then(t=>{t.isConfirmed?D(route("saveOficio"),{onSuccess:k}):Y()}):D(route("saveOficio"),{onSuccess:k})},I=r=>{const t=r.target;t.files&&i("archivo",t.files[0])},k=()=>{(s==null?void 0:s.id)===void 0&&(W({ingreso:"",num_oficio:"",num_folio:"",dep_ua:"",area:"",proceso_impacta:"",archivo:null,descripcion:""}),Q(),f([]),N.current.value="",x.current.clearValue(),j.current.clearValue(),g.current.clearValue())},ee=async r=>{g.current.clearValue();const l=await(await fetch(route("getProcesosPorArea",{id:r}),{method:"get"})).json();l.code==200&&f(l.data)};n.useEffect(()=>{(s==null?void 0:s.id)!==void 0&&(x.current.selectOption({value:s.dep_ua,label:s.des}),j.current.selectOption({value:s.id_area,label:s.area}),g.current.selectOption({value:s.proceso_impacta,label:s.proceso}))},[]);function T(r){let l=("; "+document.cookie).split("; "+r+"=");return l.length===2?decodeURIComponent(l.pop().split(";").shift()):""}return e.jsxs(ae,{children:[V&&e.jsx(G,{variant:"info-gradient",className:"mb-3 progress-xs",now:V.percentage}),e.jsxs(re,{children:[e.jsx("title",{children:"Recepción de oficio"}),e.jsx("meta",{name:"recepción de oficios",content:"Formaluario para la recepción de oficios"})]}),e.jsxs(n.Fragment,{children:[e.jsx(te,{titles:"Recepción de oficio",active:"Recepción de oficio",items:[{titulo:"Listado de oficios",urlHeader:"/oficios/listado-oficio"}]}),e.jsx(X,{children:e.jsx(d,{lg:12,md:12,children:e.jsxs(y,{children:[e.jsx(y.Header,{children:e.jsx(y.Title,{as:"h3",children:e.jsx(H,{titulo:"Información de ingreso",obligatorio:!0})})}),e.jsxs(y.Body,{children:[p&&e.jsx(pe,{variant:"success",className:"alert-dismissible",children:p}),e.jsxs("form",{onSubmit:Z,children:[e.jsx("div",{className:"form-row",children:e.jsx(d,{xl:4,md:6,className:"mb-4",children:e.jsxs(c.Group,{children:[e.jsxs(c.Label,{children:["Ingreso de la solicitud"," ",e.jsx("p",{className:"obligatorio",children:"*"})]}),e.jsxs("div",{className:"custom-controls-stacked",children:[e.jsxs("label",{className:"custom-control custom-radio-md",children:[e.jsx("input",{type:"radio",className:"custom-control-input",name:"ingreso",defaultValue:"Físico",disabled:(s==null?void 0:s.id)!==void 0,checked:m.ingreso=="Físico",onChange:()=>{i("ingreso","Físico")}}),e.jsx("span",{className:"custom-control-label",children:"Físico"})]}),e.jsxs("label",{className:"custom-control custom-radio-md",style:{marginLeft:"2rem"},children:[e.jsx("input",{type:"radio",className:"custom-control-input",name:"ingreso",defaultValue:"Email",disabled:(s==null?void 0:s.id)!==void 0,checked:m.ingreso=="Email",onChange:()=>{i("ingreso","Email")}}),e.jsx("span",{className:"custom-control-label",children:"Email"})]}),e.jsx(v,{className:"mt-1",message:o.ingreso})]})]})})}),e.jsxs("div",{className:"form-row",children:[m.ingreso=="Físico"?e.jsxs(d,{xs:12,sm:6,xl:4,className:"mb-3",children:[e.jsxs(c.Label,{children:["Número de oficio"," ",e.jsx("p",{className:"obligatorio",children:"*"})]}),e.jsx(c.Control,{name:"num_oficio",className:o.num_oficio?"inputError":"",disabled:(s==null?void 0:s.id)!==void 0,value:m.num_oficio,onChange:r=>i("num_oficio",r.target.value),type:"text"}),e.jsx(v,{className:"mt-1",message:o.num_oficio})]}):null,m.ingreso=="Email"?e.jsxs(d,{xs:12,sm:6,xl:4,className:"mb-3",children:[e.jsxs(c.Label,{children:["Número de folio"," ",e.jsx("p",{className:"obligatorio",children:"*"})]}),e.jsx(c.Control,{type:"text",name:"num_folio",className:o.num_folio?"inputError":"",disabled:(s==null?void 0:s.id)!==void 0,value:m.num_folio,onChange:r=>i("num_folio",r.target.value)}),e.jsx(v,{className:"mt-1",message:o.num_folio})]}):null,e.jsxs(d,{xs:12,sm:6,md:6,lg:6,xl:4,className:"mb-3",children:[e.jsxs(c.Label,{children:["Dependencia o Unidad Académica"," ",e.jsx("p",{className:"obligatorio",children:"*"})]}),e.jsx(L,{classNamePrefix:"Select",ref:x,className:o.dep_ua?"inputError":"",options:h,name:"dep_ua",onChange:r=>{i("dep_ua",r==null?void 0:r.value)},placeholder:"Seleccione una opción"}),e.jsx(v,{className:"mt-1",message:o.dep_ua})]}),e.jsxs(d,{xs:12,sm:6,md:6,lg:6,xl:4,className:"mb-3",children:[e.jsxs(c.Label,{children:["Área para dar respuesta"," ",e.jsx("p",{className:"obligatorio",children:"*"})]}),e.jsx(L,{classNamePrefix:"Select",ref:j,className:o.area?"inputError":"",name:"area",options:u,defaultValue:m.area,onChange:r=>{ee(r==null?void 0:r.value),i("area",r==null?void 0:r.value)},placeholder:"Seleccione una opción"}),e.jsx(v,{className:"mt-1",message:o.area})]}),e.jsxs(d,{xs:12,sm:6,md:6,lg:6,xl:4,className:"mb-3",children:[e.jsxs(c.Label,{children:["Proceso al que impacta"," ",m.area=="1"?null:e.jsx("p",{className:"obligatorio",children:"*"})]}),e.jsx(L,{classNamePrefix:"Select",options:b,ref:g,name:"proceso_impacta",className:o.proceso_impacta?"inputError":"",defaultValue:m.proceso_impacta,onChange:r=>i("proceso_impacta",r==null?void 0:r.value),placeholder:"Seleccione una opción"}),e.jsx(v,{className:"mt-1",message:o.proceso_impacta})]}),e.jsxs(d,{xs:12,sm:6,md:6,lg:6,xl:4,className:"mb-3",children:[e.jsxs(c.Label,{children:["Adjuntar archivo PDF"," ",e.jsx("p",{className:"obligatorio",children:"*"})]}),e.jsx(c.Control,{type:"file",accept:".pdf",className:o.archivo?"inputError":"",ref:N,onChange:r=>I(r)}),e.jsx(v,{className:"mt-1",message:o.archivo})]}),(s==null?void 0:s.archivo)!==void 0?e.jsx(d,{xs:12,sm:6,xl:4,style:{padding:40},children:e.jsxs("span",{className:"tag tag-radius tag-round tag-outline-danger",onClick:()=>S(!0),children:["Click para ver archivo",e.jsx("i",{className:"fa fa-file-pdf-o",style:{padding:6}})]})}):null]}),e.jsxs("div",{className:"form-row",children:[e.jsxs(c.Label,{children:["Breve descripción del asunto:"," ",e.jsx("p",{className:"obligatorio",children:"*"})]}),e.jsx("textarea",{className:o.descripcion?"form-control inputError":"form-control",name:"descripcion",value:m.descripcion,onChange:r=>i("descripcion",r.target.value),placeholder:"Máximo 1000 caracteres",rows:2,children:m.descripcion}),e.jsx(v,{className:"mt-1",message:o.descripcion})]}),e.jsx(d,{xs:12,className:"d-flex justify-content-end mt-5",children:e.jsx(me,{type:"submit",className:"mt-4",children:(s==null?void 0:s.id)>0?"Actualizar oficio":"Guardar nuevo oficio"})}),e.jsx(d,{xs:12,className:"mt-2"}),(s==null?void 0:s.id)>0?e.jsxs(X,{children:[e.jsx(d,{xs:12,className:"mt-5 mb-4",children:e.jsx(y.Header,{className:"d-flex justify-content-between",children:e.jsx(y.Title,{as:"h3",children:e.jsx(H,{titulo:"Archivos adjuntos",obligatorio:!1})})})}),e.jsx(d,{children:e.jsx(oe,{files:F,onupdatefiles:R,allowMultiple:!0,acceptedFileTypes:["application/pdf","image/jpeg","application/xml","text/xml","image/png","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],onactivatefile:r=>{const t=r.getMetadata("url"),l=r.getMetadata("extension");t&&(l=="pdf"||l=="jpg"||l=="jpeg"||l=="png"?(J({...O,urlPdf:t,extension:l}),B(!0)):window.open(t,"_blank"))},filePosterMaxHeight:150,server:{process:{url:route("oficios.uploadFilesRecepcion",{id:s.id}),method:"POST",withCredentials:!0,headers:{"X-XSRF-TOKEN":T("XSRF-TOKEN"),Accept:"application/json"},onload:r=>JSON.parse(r).id,onerror:r=>{let t="Error al subir archivo";try{const l=JSON.parse(r);l.errors&&l.errors.file&&l.errors.file.length>0?t=l.errors.file[0]:l.message&&(t=l.message)}catch{}return w.error(t),t}},revert:{url:route("oficios.deleteFileRecepcion"),method:"DELETE",withCredentials:!0,headers:{"X-XSRF-TOKEN":T("XSRF-TOKEN")},onload:()=>(w.success("Archivo eliminado"),""),onerror:r=>{let t="Error al eliminar archivo";try{t=JSON.parse(r).error||t}catch{}return w.error(t),r}},remove:(r,t,l)=>{fetch(route("oficios.deleteFileRecepcion"),{method:"DELETE",credentials:"include",headers:{"X-XSRF-TOKEN":T("XSRF-TOKEN")},body:r}).then(E=>{if(E.ok)w.success("Archivo eliminado"),t();else return E.json().then(M=>{const A=M.error||"Error al eliminar archivo";w.error(A),l(A)})}).catch(E=>{w.error("Error al eliminar archivo"),l("Error al eliminar archivo")})},load:(r,t,l,E,M,A)=>{t(new Blob)}},name:"file",labelIdle:'Arrastre y suelte sus archivos o <span class="filepond--label-action">Seleccionelos aquí</span>',onaddfile:(r,t)=>{t.origin===1&&t.getMetadata("url")&&setTimeout(()=>{const l=document.querySelector(`[data-filepond-item-id="${t.id}"] .filepond--file-info-main`);if(l){const E=t.getMetadata("url");l.innerHTML=`<a href="${E}" target="_blank" rel="noopener noreferrer">${t.filename}</a>`}},100)}})})]}):null]})]})]})})}),e.jsx($,{urlPdf:s==null?void 0:s.archivo,show:_,setShow:S,tipo:"pdf"}),e.jsx($,{urlPdf:O.urlPdf,show:z,tipo:O.extension,setShow:B})]})]})}export{Ae as default};
